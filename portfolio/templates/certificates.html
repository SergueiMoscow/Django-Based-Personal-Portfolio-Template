{% extends 'base.html' %}
{% load static %}

{% block title %}
–í—Å–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã | {{ portfolio.user_info.portfolio_name }}
{% endblock %}

{% block extra_head %}
<style>
  body {
    position: relative;
    background: transparent;
    overflow-x: hidden;
  }
  body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    background: url("{% static 'portfolio/images/bg1.avif' %}") center center / cover no-repeat fixed;
    filter: blur(10px) brightness(0.4);
    z-index: -1;
  }
</style>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const searchInput = document.getElementById('cert-search');
    const yearFilter = document.getElementById('cert-year');
    const issuerFilter = document.getElementById('cert-issuer');
    const cards = document.querySelectorAll('.flip-card');

    const years = new Set();
    const issuers = new Set();

    cards.forEach(card => {
      years.add(card.dataset.year);
      issuers.add(card.dataset.issuer);
    });

    [...years].sort().forEach(y => {
      yearFilter.innerHTML += `<option value="${y}">${y}</option>`;
    });
    [...issuers].sort().forEach(i => {
      issuerFilter.innerHTML += `<option value="${i}">${i}</option>`;
    });

    function filterCards() {
      const query = searchInput.value.toLowerCase();
      const year = yearFilter.value;
      const issuer = issuerFilter.value;

      cards.forEach(card => {
        const nameMatch = card.dataset.name.toLowerCase().includes(query);
        const yearMatch = year === 'all' || card.dataset.year === year;
        const issuerMatch = issuer === 'all' || card.dataset.issuer === issuer;

        card.style.display = (nameMatch && yearMatch && issuerMatch) ? 'block' : 'none';
      });
    }

    searchInput.addEventListener('input', filterCards);
    yearFilter.addEventListener('change', filterCards);
    issuerFilter.addEventListener('change', filterCards);

    // Modal Preview
    const modal = document.getElementById('image-modal');
    const modalImg = document.getElementById('modal-img');
    const closeBtn = document.querySelector('.close-modal');

    document.querySelectorAll('.preview-image').forEach(img => {
      img.addEventListener('click', () => {
        modalImg.src = img.src;
        modal.classList.add('show');
      });
    });

    closeBtn.addEventListener('click', () => {
      modal.classList.remove('show');
      modalImg.src = '';
    });

    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') {
        modal.classList.remove('show');
        modalImg.src = '';
      }
    });

    modal.addEventListener('click', e => {
      if (e.target === modal) {
        modal.classList.remove('show');
        modalImg.src = '';
      }
    });
  });
</script>
{% endblock %}

{% block content %}
  <!-- All Certificates Section -->
  <section id="certificates" class="section" style="padding: 100px 20px;">
    <div class="container" style="max-width: 1100px; margin: 0 auto;">
      <div style="text-align: right; margin-bottom: -30px;">
        <a href="{% url 'home' %}#certificates" class="section-label text-link">‚Üê –ù–∞–∑–∞–¥</a>
      </div>
      <h2 class="section-title" style="text-align: center; margin-bottom: 40px;">üìú –í—Å–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã</h2>
      <p class="section-description" style="text-align: center;">
        –í—Å–µ –º–æ–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏.
      </p>
      <!-- Filter Bar -->
      <div class="filter-bar">
        <input type="text" id="cert-search" placeholder="üîç –ü–æ–∏—Å–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤..." aria-label="–ü–æ–∏—Å–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤" class="filter-input" />
        <select id="cert-year" aria-label="–§–∏–ª—å—Ç—Ä –ø–æ –≥–æ–¥—É" class="filter-select">
          <option value="all">–í—Å–µ –≥–æ–¥—ã</option>
        </select>
        <select id="cert-issuer" aria-label="–§–∏–ª—å—Ç—Ä –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏" class="filter-select">
          <option value="all">–í—Å–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</option>
        </select>
      </div>
      <!-- Certificate Flip Cards -->
      <div id="cert-container" class="card-container flip-container" style="justify-content: center;">
        {% for cert in certificates %}
        <div class="flip-card scroll-fade" data-name="{{ cert.name }}" data-year="{{ cert.year }}" data-issuer="{{ cert.issuer }}">
          <div class="flip-card-inner">
            <div class="flip-card-front">
              <h3>{{ cert.name }}</h3>
              <p>{{ cert.issuer }} ({{ cert.year }})</p>
            </div>
            <div class="flip-card-back" style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
              {% if cert.image %}
              <img src="{% static 'portfolio/images/certificates/' %}{{ cert.image }}"
                   alt="{{ cert.name }}"
                   class="preview-image"
                   style="max-width: 100%; max-height: 220px; border-radius: 10px; box-shadow: 0 0 12px #fde4c388; cursor: zoom-in;">
              {% else %}
              <p>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</p>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </section>
  {% include 'modal.html' %}
{% endblock %}